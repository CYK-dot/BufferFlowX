# BufferFlowX - Bootloader组件

## 简介

Bootloader组件是BufferFlowX项目中提供镜像加载与管理功能的模块。它通过依赖注入的方式支持从不同介质加载镜像，并提供灵活的镜像管理机制。

## 主要功能

- **镜像加载与写入**：通过依赖注入方式，支持从不同介质加载镜像
- **命令行管理**：提供命令行管理接口，支持按键、串口等多种管理方式
- **镜像管理**：支持热加载、冷加载，以及swap和overwrite加载方式
- **镜像存储**：采用镜像描述头+镜像A+镜像B的存储方式
- **镜像制作**：通过ld脚本制作镜像
- **镜像类型**：支持共享库镜像和app镜像

## 核心概念

### 镜像类型

- **共享库镜像**：包含HAL+FreeRTOS等基础库，由一阶bootloader加载
- **App镜像**：应用程序镜像，由二阶bootloader加载，使用共享库

### 加载方式

- **热加载**：运行时动态加载镜像
- **冷加载**：系统启动时加载镜像
- **Swap**：交换方式加载
- **Overwrite**：覆盖方式加载

### 存储方式

采用镜像描述头→镜像A→镜像B的线性存储结构，便于管理和查找。

## 目录结构

```
bfx/bootloader/
├── design.md      # 设计文档
```

## 快速开始

### 1. 镜像制作

使用ld脚本制作镜像，支持共享库镜像和app镜像的制作。

### 2. 镜像加载

通过命令行管理接口控制镜像加载行为。

## 详细使用指南

### 镜像加载与写入

使用依赖注入方式实现从不同介质加载镜像，可根据需要扩展支持不同存储介质。

### 镜像管理

支持多种加载时间和方式的组合，满足不同应用场景需求。

## 高级特性

- **依赖注入**：灵活支持不同存储介质的镜像加载
- **多级引导**：支持一阶和二阶bootloader架构
- **符号校验**：对共享库进行校验，确保符号定义正确
- **灵活管理**：支持多种管理接口

## 最佳实践

1. 合理设计共享库和app镜像的划分
2. 正确配置ld脚本以生成合适的镜像格式
3. 实现可靠的符号校验机制
4. 选择合适的加载方式以满足应用需求

## 常见问题解答

### Q: 如何制作镜像？
A: 通过ld脚本制作镜像，支持共享库镜像和app镜像。

### Q: 支持哪些加载方式？
A: 支持热加载、冷加载，以及swap和overwrite加载方式。

### Q: 如何扩展存储介质支持？
A: 通过依赖注入方式，实现对应接口即可支持新的存储介质。

## 故障排除

1. **镜像加载失败**：检查镜像格式和存储介质访问
2. **符号校验错误**：确认共享库符号定义正确
3. **引导失败**：检查ld脚本配置和引导顺序

## 注意事项

1. 共享库需要进行校验以确保符号定义正确
2. 选择合适的加载方式以满足应用需求
3. 确保ld脚本配置正确以生成合适的镜像格式
4. 注意不同加载方式对系统资源的影响

---

**作者**: BufferFlowX 开发团队  
**版本**: 1.0  
**许可证**: MIT