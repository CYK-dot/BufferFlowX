# BufferFlowX - CLI组件

## 简介

CLI（Command Line Interface）组件是BufferFlowX项目中提供命令行接口功能的模块。它提供了命令行解析、命令注册、参数处理等功能，便于在嵌入式系统中实现交互式命令行界面。

## 主要功能

- **命令注册**：使用`BFX_CLI_REG`宏自动注册命令行函数
- **参数解析**：支持基本参数解析、类型转换和验证
- **通配符匹配**：提供强大的字符串匹配功能，支持`?`、`*`和转义字符`\`
- **AT命令支持**：提供AT命令处理功能
- **Unix风格命令**：支持Unix风格的命令行操作
- **命令视图**：提供命令显示和管理功能

## 核心概念

### 数据结构

- `BFX_CLI_REG`：命令注册宏，用于自动注册命令行函数
- 命令回调函数：处理具体命令逻辑的函数

### BFX_CliRawMatch函数

`BFX_CliRawMatch`函数用于将输入字符串与命令字符串进行匹配，其功能比标准的字符串比较函数更强大，支持通配符匹配。

## 目录结构

```
bfx/cli/
├── bfx_cli_at.c/h     # AT命令处理实现
├── bfx_cli_core.c/h   # 核心命令行处理实现
├── bfx_cli_unix.c/h   # Unix风格命令实现
├── bfx_cli_view.c/h   # 命令视图实现
└── design.md          # 设计文档
```

## 快速开始

### 1. 命令注册

```c
// 使用BFX_CLI_REG宏注册命令
BFX_CLI_REG(test_cmd) {
    // 命令处理逻辑
    printf("Test command executed\n");
    return 0;
}
```

### 2. BFX_CliRawMatch函数详解

#### 函数原型

```c
uint8_t BFX_CliRawMatch(uint8_t *str, uint8_t *cmd);
```

#### 匹配规则

| 字符 | 含义 | 举例 | 匹配示例 |
|------|------|------|----------|
| `?` | 匹配任意单个字符 | `abc?ef` | `abcdef`、`abcxef` |
| `*` | 匹配零个或多个任意字符 | `ab*fg` | `abfg`、`abcdefg`、`abxxxxfg` |
| `\` | 转义字符，使其后字符失去特殊含义 | `ab\*fg` | `ab*fg` |
| 普通字符 | 精确匹配 | `abcdef` | `abcdef` |

#### 使用示例

```c
// 匹配任意三位数字
if(BFX_CliRawMatch("123", "???")) { /* 匹配成功 */ }
if(BFX_CliRawMatch("abc", "???")) { /* 匹配成功 */ }

// 匹配以"test"开头的字符串
if(BFX_CliRawMatch("test123", "test*")) { /* 匹配成功 */ }
if(BFX_CliRawMatch("testing", "test*")) { /* 匹配成功 */ }

// 匹配特定格式的字符串
if(BFX_CliRawMatch("file.txt", "file.*")) { /* 匹配成功 */ }
if(BFX_CliRawMatch("file.log", "file.*")) { /* 匹配成功 */ }

// 转义特殊字符
if(BFX_CliRawMatch("file*.txt", "file\\*.txt")) { /* 匹配成功 */ }
```

## 详细使用指南

### 命令行注册

使用`BFX_CLI_REG`宏注册命令行函数，该宏会将命令信息存储在特定的内存段中，便于系统自动发现和调用。

### 参数解析

命令行参数解析器支持以下功能：

- 基本参数解析
- 参数类型转换
- 参数验证

## 高级特性

- **模块化设计**：支持不同平台的命令行实现
- **扩展性**：易于添加新的命令和功能
- **内存效率**：使用内存段自动注册机制，无需手动维护命令列表

## 最佳实践

1. 使用BFX_CLI_REG宏注册所有命令
2. 合理设计命令名称和参数
3. 对命令参数进行充分验证
4. 使用BFX_CliRawMatch函数实现灵活的命令匹配

## 常见问题解答

### Q: 如何实现通配符命令匹配？
A: 使用BFX_CliRawMatch函数，支持`?`匹配单个字符，`*`匹配多个字符，`\`转义特殊字符。

### Q: 如何注册新命令？
A: 使用BFX_CliRawMatch宏定义命令处理函数，系统会自动注册。

## 故障排除

1. **命令未注册**：确保使用了`BFX_CLI_REG`宏
2. **参数解析失败**：检查参数格式和类型
3. **通配符匹配异常**：检查特殊字符是否需要转义

## 注意事项

1. 命令注册使用内存段机制，需要链接器支持
2. 命令函数名不能重复
3. 使用通配符匹配时注意转义字符的使用
4. 在资源受限的嵌入式系统中，注意内存使用情况

---

**作者**: BufferFlowX 开发团队  
**版本**: 1.0  
**许可证**: MIT